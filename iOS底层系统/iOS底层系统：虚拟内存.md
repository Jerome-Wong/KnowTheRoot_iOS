# iOS底层系统：虚拟内存

## 一、什么是虚拟内存

### 1.申请内存

当我们向系统申请内存时，系统并不会直接返回物理内存的地址，而是**返回一个虚拟内存地址**。从系统角度来说，每一个进程都有相同大小的虚拟内存空间。  
只有当进程开始使用申请到的虚拟内存时，系统才会将虚拟地址映射到物理地址上，从而让程序使用真实的物理内存。

### 2.内存不够怎么办？  
当A进程占用了大部分内存，此时B进程需要内存时发现内存不足，系统则会通知App，让App清理内存，既我们熟知的Memory Warning。

## 二、内存分页

iOS系统会对虚拟内存和物理内存进行分页，**虚拟内存到物理内存的映射都是以页为最小粒度的**。

### 1.什么是分页
#### 1.1 分页的核心  
将虚拟内存空间和物理内存空间皆划分为**大小相同的页面**，如4kb、8kb或16kb等。并以页面作为内存空间的**最小单位**，一个程序的一个页面可以存放在任意一个物理页面里。
#### 1.2 分页解决了什么问题
- 解决空间浪费碎片化问题
- 解决程序大小受限问题

